drop database almacenes;
create database almacenes;
use almacenes;
Create table Productos (Producto int primary key auto_increment,Nombre nvarchar(100) , precio decimal(19,4) );
Create table Cajeros (Cajero int primary key auto_increment not null,NomApels nvarchar(255) not null);
Create table Maquinas_Registradoras (Maquina int primary key auto_increment not null,piso int not null);
Create table venta (cajero int not null ,maquina int not null,Producto int not null,
FOREIGN KEY (Producto) REFERENCES Productos(Producto),
FOREIGN KEY (Maquina) REFERENCES Maquinas_Registradoras(Maquina),
FOREIGN KEY (Cajero) REFERENCES Cajeros(Cajero));


load data infile 'D:\\eclipse\\DatosDb\\productos.csv' into table Productos fields terminated by ',' optionally enclosed by '"' lines terminated by '\r\n';
load data infile 'D:\\eclipse\\DatosDb\\cajeros.csv' into table Cajeros fields terminated by ',' optionally enclosed by '"' lines terminated by '\r\n';
load data infile 'D:\\eclipse\\DatosDb\\resgistradoras.csv' into table Maquinas_Registradoras fields terminated by ',' optionally enclosed by '"' lines terminated by '\r\n';
load data infile 'D:\\eclipse\\DatosDb\\ventas.csv' into table venta fields terminated by ',' optionally enclosed by '"' lines terminated by '\r\n';

select * from productos;
select * from cajeros;
select * from Maquinas_Registradoras;

select * from venta;

#Mostrar el número de ventas de cada producto, ordenado de más a menos ventas.
select p.nombre, (select count(*) from venta v where v.producto = p.producto) VentasTotales  from productos p order by VentasTotales desc;

#Obtener un informe completo de ventas, indicando el nombre del cajero que realizo la venta, nombre y precios de los productos vendidos, y el piso en el que se encuentra la máquina registradora donde se realizó la venta.

select v.cajero Caja,c.NomApels Cajero, p.nombre Producto,p.precio costo,m.piso from venta v,cajeros c,productos p,Maquinas_Registradoras m
where v.cajero = c.cajero and v.producto = p.producto and v.maquina = m.maquina;

#Obtener las ventas totales realizadas en cada piso.
select distinct piso, (select sum(p.precio)from venta v,Maquinas_Registradoras ma,productos p where ma.maquina = v.maquina and p.producto = v.producto and ma.piso = m.piso)VentaPiso 
 from Maquinas_Registradoras m;

#Obtener el código y nombre de cada cajero junto con el importe total de sus ventas
select c.cajero,c.nomapels,
(select sum(p.precio) from venta v,cajeros ca,productos p where v.cajero = ca.cajero and v.producto = p.producto and ca.cajero = c.cajero)NumVentas 
from cajeros c;

#Obtener el código y nombre de aquellos cajeros que hayan realizado ventas en pisos cuyas ventas totales sean inferiores a los 5000 pesos

select ca.cajero,ca.nomapels,ve.maquina,m.piso, (select sum(p.precio)from venta v,Maquinas_Registradoras ma,productos p where ma.maquina = v.maquina and p.producto = v.producto and ma.piso = m.piso) VentaPiso 
 from venta ve,Maquinas_Registradoras m,cajeros ca where 
(select sum(p.precio)from venta v,Maquinas_Registradoras ma,productos p where ma.maquina = v.maquina and p.producto = v.producto and ma.piso = m.piso) <3000.0
and ve.maquina = m.maquina
and ca.cajero = ve.cajero;

select distinct ca.cajero,ca.nomapels
 from venta ve,Maquinas_Registradoras m,cajeros ca 
where (select sum(p.precio)from venta v,Maquinas_Registradoras ma,productos p where ma.maquina = v.maquina and p.producto = v.producto and ma.piso = m.piso) <3000.0
and ve.maquina = m.maquina
and ca.cajero = ve.cajero;


